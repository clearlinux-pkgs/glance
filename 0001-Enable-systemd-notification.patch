From 4dbeec55d73e96794c85d456e5619249353e01ad Mon Sep 17 00:00:00 2001
From: Victor Morales <victor.morales@intel.com>
Date: Wed, 30 Sep 2015 16:22:17 -0500
Subject: [PATCH] Enable systemd notification

Signed-off-by: Victor Morales <victor.morales@intel.com>
---
 glance/cmd/api.py      | 2 ++
 glance/cmd/registry.py | 2 ++
 glance/cmd/scrubber.py | 2 ++
 3 files changed, 6 insertions(+)

diff --git a/glance/cmd/api.py b/glance/cmd/api.py
index 9d64c13..66f26b2 100755
--- a/glance/cmd/api.py
+++ b/glance/cmd/api.py
@@ -44,6 +44,7 @@ import glance_store
 from oslo_config import cfg
 from oslo_log import log as logging
 import oslo_messaging
+from oslo_service import systemd
 import osprofiler.notifier
 import osprofiler.web
 
@@ -86,6 +87,7 @@ def main():
 
         server = wsgi.Server(initialize_glance_store=True)
         server.start(config.load_paste_app('glance-api'), default_port=9292)
+        systemd.notify_once()
         server.wait()
     except KNOWN_EXCEPTIONS as e:
         fail(e)
diff --git a/glance/cmd/registry.py b/glance/cmd/registry.py
index 4e4117a..d6934b6 100755
--- a/glance/cmd/registry.py
+++ b/glance/cmd/registry.py
@@ -41,6 +41,7 @@ if os.path.exists(os.path.join(possible_topdir, 'glance', '__init__.py')):
 from oslo_config import cfg
 from oslo_log import log as logging
 import oslo_messaging
+from oslo_service import systemd
 import osprofiler.notifier
 import osprofiler.web
 
@@ -73,6 +74,7 @@ def main():
         server = wsgi.Server()
         server.start(config.load_paste_app('glance-registry'),
                      default_port=9191)
+        systemd.notify_once()
         server.wait()
     except RuntimeError as e:
         sys.exit("ERROR: %s" % encodeutils.exception_to_unicode(e))
diff --git a/glance/cmd/scrubber.py b/glance/cmd/scrubber.py
index 1d2fa4c..e7d0151 100755
--- a/glance/cmd/scrubber.py
+++ b/glance/cmd/scrubber.py
@@ -34,6 +34,7 @@ import eventlet
 import glance_store
 from oslo_config import cfg
 from oslo_log import log as logging
+from oslo_service import systemd
 
 from glance.common import config
 from glance import scrubber
@@ -62,6 +63,7 @@ def main():
         if CONF.daemon:
             server = scrubber.Daemon(CONF.wakeup_time)
             server.start(app)
+            systemd.notify_once()
             server.wait()
         else:
             app.run()
-- 
2.1.0

